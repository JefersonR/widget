// Generated by CoffeeScript 1.8.0
(function() {
  var HEIGHT, HOST, PROTOCOL, WIDTH, addEventListener, attach_element, configure, createElement, create_iframe, getElementById, options_for, origin_for, path_for, query_for;

  PROTOCOL = "https";

  HOST = "widget.clicksign.com";

  WIDTH = {
    MIN: 600,
    DEFAULT: 800
  };

  HEIGHT = {
    MIN: 500,
    DEFAULT: 600
  };

  getElementById = function(name) {
    return document.getElementById(name);
  };

  createElement = function(element) {
    return document.createElement(element);
  };

  addEventListener = function(callback) {
    return window.addEventListener("message", callback);
  };

  options_for = function(options) {
    var k, v;
    return ((function() {
      var _results;
      _results = [];
      for (k in options) {
        v = options[k];
        _results.push("" + k + "=" + v);
      }
      return _results;
    })()).join("&");
  };

  origin_for = function(protocol, host) {
    return "" + (protocol || PROTOCOL) + "://" + (host || HOST);
  };

  path_for = function(key) {
    return "/documents/" + key;
  };

  query_for = function(signer) {
    if (signer == null) {
      signer = {};
    }
    return ("?origin=" + location.origin + "&") + options_for(signer);
  };

  create_iframe = function(source, width, height) {
    var iframe, min, normalize, normalize_height, normalize_width;
    min = function(m) {
      return function(v) {
        if (v < m) {
          return m;
        } else {
          return v;
        }
      };
    };
    normalize = function(m, d) {
      return function(v) {
        return min(m)(v || d);
      };
    };
    normalize_width = normalize(WIDTH.MIN, WIDTH.DEFAULT);
    normalize_height = normalize(HEIGHT.MIN, HEIGHT.DEFAULT);
    iframe = createElement("iframe");
    iframe.setAttribute('src', source);
    iframe.setAttribute('width', normalize_width(width));
    iframe.setAttribute('height', normalize_height(height));
    iframe.setAttribute('style', 'border: 1px solid #777; border-radius: 3px;');
    return iframe;
  };

  attach_element = function(container, element) {
    var target;
    target = getElementById(container);
    return target.appendChild(element);
  };

  configure = function(options) {
    var callback, iframe, origin, path, query, source;
    origin = origin_for(options.protocol, options.host);
    path = path_for(options.key);
    query = query_for(options.signer);
    source = origin + path + query;
    iframe = create_iframe(source, options.width, options.height);
    attach_element(options.container, iframe);
    callback = options.callback || function() {};
    return addEventListener("message", options.callback || function() {});
  };

  this.clicksign || (this.clicksign = {
    configure: configure
  });

}).call(this);
